<%= render 'layouts/map_js' %>

<script id="center_map" type="text/javascript" data-long=<%= center['longitude']%> data-lat=<%= center['latitude']%> >
  function initialize() {
    
    console.log("map center:", <%= center['latitude'] %>, <%= center['longitude'] %>);
    
    var script = document.getElementById("center_map");
    var data_lat = script.getAttribute('data-lat');
    var data_long = script.getAttribute('data-long');
    
    var mapOptions = {
      center: new google.maps.LatLng(data_lat, data_long),
      zoom: 14
    };
    
    var map = new google.maps.Map(document.getElementById("map-canvas"),
        mapOptions);  
        
    <% businesses.each do |business| %>    
  
    var bizLat = <%= business.location.coordinates['latitude'] %>;
    
    var bizLon = <%= business.location.coordinates['longitude'] %>;
            
    new google.maps.Marker({
        position: new google.maps.LatLng(bizLat, bizLon),
        map: map
    });
    
    <% end %>
  }
  google.maps.event.addDomListener(window, 'load', initialize);
</script>